# DOCX Assets Templates Analysis
## `/app/.kimi/skills/docx/assets/templates/` — C# Document Generation Templates

---

## Executive Summary

The `templates/` directory contains C# source files that serve as the foundation for DOCX document generation using the OpenXML SDK. These templates demonstrate professional document patterns including cover pages, tables of contents, charts, tables, and cross-references.

---

## 1. File Inventory

| File | Purpose | Lines |
|------|---------|-------|
| `KimiDocx.csproj` | .NET project configuration | 15 |
| `Program.cs` | Entry point stub | 7 |
| `Example.cs` | Complete English document example | ~1,100 |
| `CJKExample.cs` | Chinese/Japanese/Korean document example | ~1,000 |

---

## 2. KimiDocx.csproj

### 2.1 Project Configuration

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <TargetFramework>net8.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="DocumentFormat.OpenXml" Version="3.0.2" />
  </ItemGroup>
</Project>
```

### 2.2 Key Configuration

| Setting | Value | Purpose |
|---------|-------|---------|
| `OutputType` | `Exe` | Console application |
| `TargetFramework` | `net8.0` | .NET 8 runtime |
| `ImplicitUsings` | `enable` | Automatic using directives |
| `Nullable` | `enable` | Null safety |
| `PackageReference` | `DocumentFormat.OpenXml 3.0.2` | OpenXML SDK |

---

## 3. Program.cs

### 3.1 Entry Point Stub

```csharp
// Program.cs - Document generation entry point
// Model will overwrite this file with actual implementation
// Reference: Example.cs (structure), CJKExample.cs (CJK content)

string output = args.Length > 0 ? args[0] : "/mnt/okcomputer/output/output.docx";
Console.WriteLine($"Please implement document generation logic. Output: {output}");
```

### 3.2 Purpose

This stub file is overwritten during document generation. The actual implementation is generated by the agent based on user requirements, using `Example.cs` and `CJKExample.cs` as reference patterns.

---

## 4. Example.cs — English Document Reference

### 4.1 Architecture Overview

```csharp
public static class Example
{
    // Color scheme definition
    private static class Colors { ... }
    
    // A4 size constants
    private const int A4WidthTwips = 11906;
    private const int A4HeightTwips = 16838;
    
    // Main generation method
    public static void Generate(string outputPath, string bgDir) { ... }
    
    // Section builders
    private static void AddCoverSection(Body body, string coverImageId) { ... }
    private static void AddTocSection(Body body, string bodyImageId, MainDocumentPart mainPart) { ... }
    private static void AddContentSection(...) { ... }
    private static void AddBackcoverSection(Body body, string backcoverImageId) { ... }
    
    // Helper methods
    private static void AddStyles(MainDocumentPart mainPart) { ... }
    private static void AddNumbering(MainDocumentPart mainPart) { ... }
    private static string AddImage(MainDocumentPart mainPart, string imagePath) { ... }
    private static Drawing CreateFloatingBackground(string imageId, uint docPrId, string name) { ... }
    private static void AddInlineImage(...) { ... }
    private static void AddPieChart(Body body, MainDocumentPart mainPart) { ... }
    private static void AddBarChart(Body body, MainDocumentPart mainPart) { ... }
    private static Table CreateDataTable() { ... }
    private static Table CreateMilestoneTable() { ... }
}
```

### 4.2 Color Scheme: Morandi Nordic Style

```csharp
private static class Colors
{
    // Morandi primary colors
    public const string Primary = "7C9885";       // Sage green - main headings
    public const string Secondary = "8B9DC3";     // Gray blue - secondary
    public const string Accent = "9CAF88";        // Grass green - accent

    // Text color scale
    public const string Dark = "2d3a35";          // Dark text (greenish gray)
    public const string Mid = "5a6b62";           // Secondary text
    public const string Light = "8a9a90";         // Helper text

    // Background/Border
    public const string Border = "d8e0dc";
    public const string TableHeader = "f0f4f2";
}
```

### 4.3 Document Structure

```
Document
├── Cover Section
│   ├── Background image (floating, BehindDoc)
│   ├── Large whitespace (SpacingBefore=6000)
│   ├── Main title (96pt, left-aligned)
│   ├── Subtitle (24pt, primary color)
│   └── Company info and date
├── Table of Contents Section
│   ├── TOC title (Heading1 style)
│   ├── Hint text (refresh page numbers)
│   ├── TOC field code (\o "1-3" \h \z \u)
│   └── Placeholder entries
├── Body Content Section
│   ├── Header with background image
│   ├── Footer with page numbers (PAGE / NUMPAGES)
│   ├── Executive Summary
│   │   └── Footnote
│   ├── Project Background
│   │   ├── Industry Overview
│   │   └── Customer Pain Points
│   │       └── Bar chart
│   ├── Proposed Solution
│   │   ├── Core Modules table
│   │   └── Pie chart
│   └── Project Timeline
│       └── Milestone table
└── Back Cover Section
    ├── Background image
    ├── Company name
    ├── Contact info
    └── Copyright
```

### 4.4 Key Technical Patterns

#### Floating Background Image

```csharp
private static Drawing CreateFloatingBackground(string imageId, uint docPrId, string name)
{
    return new Drawing(
        new DW.Anchor(
            new DW.SimplePosition { X = 0, Y = 0 },
            new DW.HorizontalPosition(new DW.PositionOffset("0"))
            { RelativeFrom = DW.HorizontalRelativePositionValues.Page },
            new DW.VerticalPosition(new DW.PositionOffset("0"))
            { RelativeFrom = DW.VerticalRelativePositionValues.Page },
            new DW.Extent { Cx = A4WidthEmu, Cy = A4HeightEmu },
            // ... picture properties
        )
        {
            BehindDoc = true,  // Key: behind text
            Locked = false,
            LayoutInCell = true,
            AllowOverlap = true
        }
    );
}
```

#### Inline Image with Auto-Resize

```csharp
private static void AddInlineImage(Body body, MainDocumentPart mainPart, 
    string imagePath, string altText, uint docPrId, int maxWidthCm = 15)
{
    // Read PNG dimensions from header
    // Width at offset 16-19, Height at offset 20-23 (big-endian)
    // Calculate display dimensions maintaining aspect ratio
    // Create inline Drawing element
}
```

#### Native Pie Chart

```csharp
private static void AddPieChart(Body body, MainDocumentPart mainPart)
{
    var chartPart = mainPart.AddNewPart<ChartPart>();
    chartPart.ChartSpace = CreatePieChartSpace();
    // Uses NumberLiteral for data (no Excel dependency)
    // DataPoint for custom colors
}
```

#### Three-Line Table

```csharp
private static Table CreateDataTable()
{
    var table = new Table();
    
    table.Append(new TableProperties(
        new TableWidth { Width = "5000", Type = TableWidthUnitValues.Pct },
        new TableBorders(
            new TopBorder { Val = BorderValues.Single, Size = 12, Color = TableColors.BorderThick },
            new BottomBorder { Val = BorderValues.Single, Size = 12, Color = TableColors.BorderThick },
            // Inside borders: Nil (three-line style)
            new InsideHorizontalBorder { Val = BorderValues.Nil },
            new InsideVerticalBorder { Val = BorderValues.Nil }
        )
    ));
    
    // tblGrid REQUIRED before rows
    table.Append(new TableGrid(
        new GridColumn { Width = "2200" },
        new GridColumn { Width = "5800" },
        new GridColumn { Width = "2000" }
    ));
    
    // Header row with bottom border
    // Data rows
}
```

---

## 5. CJKExample.cs — Chinese Document Reference

### 5.1 Key Difference: CJK Quote Handling

**The Compilation Problem**:
```csharp
// ❌ WRONG - Chinese quotes break C# compilation
new Text("请点击"确定"按钮")  // CS1003: Syntax error, ',' expected

// ✓ CORRECT - Unicode escapes
new Text("请点击\u201c确定\u201d按钮")
```

**Unicode Mapping**:

| Character | Unicode | Usage |
|-----------|---------|-------|
| " (left double) | `\u201c` | Opening quote |
| " (right double) | `\u201d` | Closing quote |
| ' (left single) | `\u2018` | Opening single |
| ' (right single) | `\u2019` | Closing quote |

**Verbatim String Trap**:
```csharp
// ❌ WRONG - @"" verbatim string, \u NOT escaped
string text = @"她说\u201c你好\u201d";  // Literal output: 她说\u201c你好\u201d

// ✓ CORRECT - regular string, \u IS escaped
string text = "她说\u201c你好\u201d";   // Output: 她说"你好"
```

### 5.2 Chinese Typography

```csharp
// First-line indentation for Chinese paragraphs
new Indentation { FirstLine = "420" }  // 2 characters

// Chinese fonts
new RunFonts { EastAsia = "Microsoft YaHei" }  // Body
new RunFonts { EastAsia = "SimHei" }           // Headings

// Chinese colon
new Run(new Text("：" + description))  // Full-width colon
```

### 5.3 Color Scheme: Ink Wash Wabi-Sabi

```csharp
private static class Colors
{
    public const string Primary = "4A5568";      // Ink gray - headings
    public const string Secondary = "718096";    // Silver gray
    public const string Accent = "A0AEC0";       // Light gray-blue
    public const string Dark = "1A202C";         // Dark ink
    public const string Mid = "4A5568";          // Light ink
    public const string Light = "A0AEC0";        // Pale ink
    public const string TableHeader = "EDF2F7";  // Rice paper white
}
```

---

## 6. Template Generation Workflow

```
1. User Request → Agent analyzes requirements
        │
        ▼
2. Select Template → Example.cs (English) or CJKExample.cs (CJK)
        │
        ▼
3. Generate Program.cs → Overwrite with custom implementation
        │
        ▼
4. dotnet build → Compile to executable
        │
        ▼
5. dotnet run → Generate .docx file
        │
        ▼
6. Validation → OpenXML validator + business rules
```

---

*Document Version: 1.0*
*Analysis Date: 2026-02-02*
